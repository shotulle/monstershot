<html>
    <head>
        <title>game</title>
        <style>
            canvas {
                border-style: dashed;
                border-width: 1px;
                border-color: blue;
            }
        </style>
    </head>

    <body>
            <canvas id="canvas" width="800" height="1000"></canvas>

            <script>
                var c = document.getElementById("canvas");
                var ctx = c.getContext("2d");   

                document.addEventListener("keydown", keyDownFunc);
                document.addEventListener("keyup", keyUpFunc);
                document.addEventListener("mousemove", mouseMove);
                document.addEventListener("mousedown", mouseDown);
                document.addEventListener("mouseup", mouseUp);

                var keyDown = {};
                var key = {
                    W: 87,
                    A: 65,
                    S: 83,
                    D: 68,
                    ENTER: 13,
                    SPACE: 32,
                    ONE   : 49,
                    TWO   : 50,
                    THREE : 51
                };

                var bullet = [];

                var WEAPON = {
                    NORMAL     : 1,
                    MACHINEGUN : 2,
                    SHOTGUN    : 3
                };

                var INTERVAL = {
                    NORMAL     : 15,
                    MACHINEGUN : 5,
                    SHOTGUN    : 60
                };

                var mouseX;
                var mouseY;
                var mouseIsDown = false;

                // var player = new Player();

                game = setInterval(loop, 1000 / 60);

                function keyDownFunc(e) {
                    keyDown[e.keyCode] = true;
                }

                function keyUpFunc(e) {
                    keyDown[e.keyCode] = false;
                }

                function mouseMove(e) {
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                }

                function mouseDown() {
                    mouseIsDown = true;
                }

                function mouseUp() {
                    mouseIsDown = false;
                }
                

                class Enemy {
                    constructor() {
                        this.x = Math.random() * 800;
                        this.y = Math.random() * 1000;
                        this.dx = 2;
                        this.dy = 2;
                        this.size = 25;
                        this.param = 0;
                        this.alive = true;
                        this.type = 0;
                        this.angle = 270;
                        this.sides = 14;
                        this.count = 0;
                    }
                    // calc(bulletx, bullety) {
                    //     for (var i = 0; i < 5; i++)
                    //     {
                    //         if (bulletx > this.x - this.size && bulletx < this.x + this.size && bullety > this.y - this.size && bullety < this.y + this.size)
                    //         {
                    //             enemies.splice(i);
                    //         }
                    //     }
                    // }
                    
                    move(playerx, playery) {
                        if (this.x > playerx && this.y > playery)
                        {
                            this.x -= this.dx;
                            this.y -= this.dy;
                        }
                        else if (this.x < playerx && this.y < playery)
                        {
                            this.x += this.dx;
                            this.y += this.dy;
                        }
                        else if (this.x > playerx && this.y < playery)
                        {
                            this.x -= this.dx;
                            this.y += this.dy;
                        }
                        else if (this.x < playerx && this.y > playery)
                        {
                            this.x += this.dx;
                            this.y -= this.dy;
                        }
                    }

                    draw() {
                        var dent = this.size * 0.5;
                        var radOffset = this.angle * Math.PI/180;
                        var radDiv = (Math.PI*2)/this.sides/2;
                        
                        if (this.alive == true)
                        {
                            ctx.beginPath();
                            ctx.moveTo(this.x + Math.cos(radOffset) * this.size, this.y + Math.sin(radOffset) * this.size);
                            for (var i = 1; i < this.sides * 2; i++) {
                                var rad = radDiv * i + radOffset;
                                var len = (i % 2) ? dent : this.size;
                                ctx.lineTo(
                                    this.x + Math.cos(rad)*len,
                                    this.y + Math.sin(rad)*len
                                );
                                ctx.fillStyle = 'rgb(7, 111, 0)';
                                ctx.fill();
                            }
                        }
                    }

                    // kill() {
                    //     var removeEnemy = enemies.splice(Math.random()*enemies.length)
                    // }

                    // randomKill() {
                    //     var pos = enemies.indexOf(Math.floor(Math.random()*enemies.length));
                    //     if ((keyDown[key.SPACE]))
                    //     {
                    //         enemies.splice(pos);
                    //     }
                    // }

                    kill() {
                        this.count++;
                        this.alive = false;
                    }
                   
                    gameClear() {
                        if (this.count == number_of_enemies) {
                        clearInterval(game)
                        for (var i = 0; i < 6; i++)
                        {
                            ctx.font = "120" - (i*5) + "px serif";
                            ctx.fillStyle = 'rgb(' + Math.floor(Math.random()*255) + ',' + Math.floor(Math.random()*255) + ',' + Math.floor(Math.random()*255) + ')';
                            ctx.fillText("GAME CLEAR", 75 + (i * 10), 500 + (i * 5));
                        }
                        }

                    }

                    
                }

                var number_of_enemies = 5;
                var enemies = [];
                for (var i = 0; i < number_of_enemies; i++)
                {
                    enemies.push(new Enemy());
                }


                class Player {
                    constructor() {
                        this.size = 25;
                        this.x = 50;
                        this.y = 50;
                        this.speed = 7;
                        this.dx = 0; 
                        this.dy = 0;           
                        this.acceleration = 0.5; 
                        this.friction = 0.92;    
                        this.radian = 0;          
                        this.eyeSize = this.size / 5;
                        this.eyeX = 0;           
                        this.eyeY = 0;
                        this.weapon = WEAPON.NORMAL;
                        this.reloadNormal = 0;
                        this.reloadMachinegun = 0;
                        this.reloadShotgun = 0;
                        this.alive = true;
                    }

                    reload() {
                    if (this.reloadNormal > 0)
                        this.reloadNormal--;
                    if (this.reloadMachinegun > 0)
                        this.reloadMachinegun--;
                    if (this.reloadShotgun > 0)
                        this.reloadShotgun--;
                    }

                    vector() {
                        if (keyDown[key.W])  this.dy -= this.acceleration;
                        if (keyDown[key.A])  this.dx -= this.acceleration;
                        if (keyDown[key.S])  this.dy += this.acceleration;
                        if (keyDown[key.D])  this.dx += this.acceleration;
                        
                        this.dx = this.dx * this.friction;
                        this.dy = this.dy * this.friction;
                    }

                    weaponChange() {
                        if (keyDown[key.ONE]) this.weapon = WEAPON.NORMAL;
                        if (keyDown[key.TWO]) this.weapon = WEAPON.MACHINEGUN;
                        if (keyDown[key.THREE]) this.weapon = WEAPON.SHOTGUN;
                    }

                    playerRadian() {
                        var dx = mouseX - this.x;
                        var dy = mouseY - this.y;
                        this.radian = Math.atan2(dy,dx);
                    }

                    move() {
                        this.x += this.dx;
                        this.y += this.dy;
                        
                        this.eyeX = 0.45 * this.size*Math.cos(this.radian);
                        this.eyeY = 0.45 * this.size*Math.sin(this.radian);
                    }

                    draw() {
                        if (this.alive)
                        {
                            ctx.beginPath();
                            ctx.arc(this.x, this.y, this.size, 0, Math.PI*2, true);
                            ctx.fillStyle = 'white';
                            ctx.fill();

                            ctx.beginPath();
                            ctx.arc(this.x + this.eyeX - 10, this.y + this.eyeY, this.size / 5, 0, Math.PI*2, true);
                            ctx.fillStyle = 'rgb(223, 153, 179)';
                            ctx.fill();
                            ctx.beginPath();
                            ctx.arc(this.x + this.eyeX + 10, this.y + this.eyeY, this.size / 5, 0, Math.PI*2, true);
                            ctx.fillStyle = 'rgb(223, 153, 179)';
                            ctx.fill();
                        }
                        else if (this.alive == false)
                        {
                            ctx.beginPath();
                            ctx.arc(this.x, this.y, this.size, 0, Math.PI*2, true);
                            ctx.fillStyle = 'white';
                            ctx.fill();

                            ctx.beginPath();
                            ctx.moveTo(this.x + this.eyeX - 10, this.y + this.eyeY + 3);
                            ctx.lineTo(this.x + this.eyeX - 10, this.y + this.eyeY + 17);
                            ctx.strokeStyle = 'rgb(109, 222, 249)'
                            ctx.lineWidth = 5;
                            ctx.stroke();

                            ctx.beginPath();
                            ctx.moveTo(this.x + this.eyeX + 10, this.y + this.eyeY + 3);
                            ctx.lineTo(this.x + this.eyeX + 10, this.y + this.eyeY + 17);
                            ctx.strokeStyle = 'rgb(109, 222, 249)'
                            ctx.stroke();

                            ctx.beginPath();
                            ctx.moveTo(this.x + this.eyeX - 15, this.y + this.eyeY - 5);
                            ctx.lineTo(this.x + this.eyeX - 5, this.y + this.eyeY + 5);
                            ctx.moveTo(this.x + this.eyeX - 5, this.y + this.eyeY - 5);
                            ctx.lineTo(this.x + this.eyeX - 15, this.y + this.eyeY + 5);
                            ctx.lineWidth = 4;
                            ctx.strokeStyle = 'rgb(223, 153, 179)';
                            ctx.stroke();
                            ctx.beginPath();
                            ctx.moveTo(this.x + this.eyeX + 5, this.y + this.eyeY - 5);
                            ctx.lineTo(this.x + this.eyeX + 15, this.y + this.eyeY + 5);
                            ctx.moveTo(this.x + this.eyeX + 15, this.y + this.eyeY - 5);
                            ctx.lineTo(this.x + this.eyeX + 5, this.y + this.eyeY + 5);
                            ctx.strokeStyle = 'rgb(223, 153, 179)';
                            ctx.stroke();

                        }
        
                    }

                    touchEnemy() {
                        this.alive = false;
                        clearInterval(game);
                    }

                    gameOver() {
                        for (var i = 0; i < 6; i++)
                        {
                            ctx.font = "120" - (i*5) + "px serif";
                            ctx.fillStyle = 'rgb(' + Math.floor(Math.random()*255) + ',' + Math.floor(Math.random()*255) + ',' + Math.floor(Math.random()*255) + ')';
                            ctx.fillText("GAME OVER", 75 + (i * 10), 500 + (i * 5));
                        }
                    }

                }

                var player = new Player();


                // function reload() {
                //     if (player.reloadNormal > 0)
                //         player.reloadNormal--;
                //     if (player.reloadMachinegun > 0)
                //         player.reloadMachinegun--;
                //     if (player.reloadShotgun > 0)
                //         player.reloadShotgun--;

                    
                // }

                // function weaponChange() {
                //     if (keyDown[key.ONE]) player.weapon = WEAPON.NORMAL;
                //     if (keyDown[key.TWO]) player.weapon = WEAPON.MACHINEGUN;
                //     if (keyDown[key.THREE]) player.weapon = WEAPON.SHOTGUN;
                // }

                function shot() {
                    switch (player.weapon) {
                    case WEAPON.NORMAL:
                        if (player.reloadNormal === 0) {
                            bullet.push( new Bullet(5, player.x, player.y, player.radian, 3, 400) );
                            player.reloadNormal = INTERVAL.NORMAL;
                        }
                        break;
                    case WEAPON.MACHINEGUN:
                        if (player.reloadMachinegun === 0) {
                            bullet.push( new Bullet(5, player.x, player.y, player.radian, 7, 200) );
                            player.reloadMachinegun = INTERVAL.MACHINEGUN;
                        }
                        break;
                    case WEAPON.SHOTGUN:
                        if (player.reloadShotgun === 0) {
                            for (var i = -5; i <= 5; i++) {
                                var rad = i * Math.PI / 35;
                                bullet.push( new Bullet(3, player.x, player.y, player.radian + rad, 5, 100) );
                            }
                            player.reloadShotgun = INTERVAL.SHOTGUN;
                        }
                        break;
                    }  
                }

                // function calcPlayerVector() {
                //     if (keyDown[key.W])  player.dy -= player.acceleration;
                //     if (keyDown[key.A])  player.dx -= player.acceleration;
                //     if (keyDown[key.S])  player.dy += player.acceleration;
                //     if (keyDown[key.D])  player.dx += player.acceleration;
                    
                //     player.dx = player.dx * player.friction;
                //     player.dy = player.dy * player.friction;
                // }

                // function calcPlayerRadian() {
                //     var dx = mouseX - player.x;
                //     var dy = mouseY - player.y;
                //     player.radian = Math.atan2(dy,dx);
                // }

                function calcBulletLimit() {
                    for (var i = 0; i < bullet.length; i++) {
                        if ( bullet[i].limit > 0 ) {
                            bullet[i].limit--;
                        } else {
                            bullet.splice(i, 1);
                            i--;
                        }
                    }
                }

               
                // function calcEnemy() {
                //     var i;
                //     var j;

                //     if(counter % 100 === 0){
                //     for(i = 0; i < max; i++){
                //         if(!enemy[i].alive){
                //             j = (counter % 200) / 100;
                //             enemy.x = - enemy.size + (canvas.width + enemy.size * 2) * j
                //             enemy.y = canvas.height / 2;

                //             enemy[i].set();

                //             break;
                //         }
                //     }
                //     j = (counter % 200) / 100;

                //     p.x = -enemy.size + (canvas.width + enemy.size * 2) * j
                //     p.y = canvas.height / 2;
                //     }
                // }

                // function enemySet() {
                //     enemy.x = p.x;
                //     enemy.y = p.y;
                //     enemy.size = size;
                //     enemy.param = 0;
                //     enemy.alive = true;
                //     enemy.type = type;
                // }



                // function playerMove() {
                //     player.x += player.dx;
                //     player.y += player.dy;
                    
                //     player.eyeX = 0.45 * player.size*Math.cos(player.radian);
                //     player.eyeY = 0.45 * player.size*Math.sin(player.radian);
                // }

                function bulletMove() {
                    for (var i = 0; i < bullet.length; i++) {
                        bullet[i].x += bullet[i].speed * Math.cos(bullet[i].radian);
                        bullet[i].y += bullet[i].speed * Math.sin(bullet[i].radian);
                    }
                }

                // function enemyMove(enemy) {
                //     if (enemy.x > player.x && enemy.y > player.y)
                //     {
                //         enemy.x -= enemy.dx;
                //         enemy.y -= enemy.dy;
                //     }
                //     else if (enemy.x < player.x && enemy.y < player.y)
                //     {
                //         enemy.x += enemy.dx;
                //         enemy.y += enemy.dy;
                //     }
                //     else if (enemy.x > player.x && enemy.y < player.y)
                //     {
                //         enemy.x -= enemy.dx;
                //         enemy.y += enemy.dy;
                //     }
                //     else if (enemy.x < player.x && enemy.y > player.y)
                //     {
                //         enemy.x += enemy.dx;
                //         enemy.y -= enemy.dy;
                //     }      
                // }


                
                // function playerDraw() {
                //     ctx.beginPath();
                //     ctx.arc(player.x, player.y, player.size, 0, Math.PI*2, true);
                //     ctx.fillStyle = 'white';
                //     ctx.fill();

                    
                //     ctx.beginPath();
                //     ctx.arc(player.x + player.eyeX - 10, player.y + player.eyeY, player.size / 5, 0, Math.PI*2, true);
                //     ctx.fillStyle = 'rgb(223, 153, 179)';
                //     ctx.fill();
                //     ctx.beginPath();
                //     ctx.arc(player.x + player.eyeX + 10, player.y + player.eyeY, player.size / 5, 0, Math.PI*2, true);
                //     ctx.fillStyle = 'rgb(223, 153, 179)';
                //     ctx.fill();
        
                // }

                function bulletDraw() {
                    for (var i = 0; i < bullet.length; i++) {
                        ctx.beginPath();
                        ctx.arc(bullet[i].x, bullet[i].y, bullet[i].size, 0, Math.PI*2, true);
                        ctx.fillStyle = 'rgb(250, 254, 121)';
                        ctx.fill();
                    }
                }

                function loop() {
                    for (var i = 0; i < bullet.length; i++)
                    {
                        for (var j = 0; j < enemies.length; j++)
                        {
                            if(Math.abs(enemies[j].x - bullet[i].x) < 15 && Math.abs(enemies[j].y - bullet[i].y) < 15)
                            {
                                enemies[j].kill();
                            }
                        }
                    }
                    if (keyDown[key.SPACE]) {
                        enemies[Math.floor(Math.random()*enemies.length)].kill();
                    }   
                    if (keyDown[key.ENTER]) {
                        for (i = 0; i < enemies.length; i++)
                        {
                            if(!enemies[i].alive) {
                                enemies[i].alive = true;
                            }
                        }
                    }             
                    player.vector();
                    player.playerRadian();
                    // calcEnemy();
                    // calcBulletLimit();
                    // for (var i = 0; i < enemies.length; i++) {
                       
                    //     enemies[i].randomKill();
                    
                    // }

                    for (var i = 0; i < enemies.length; i++)
                    {
                        if (!enemies[i].alive) {
                            continue;
                        }
                        if (Math.abs(enemies[i].x - player.x) < 45 && Math.abs(enemies[i].y - player.y) < 45)
                        {
                            player.touchEnemy();
                            setInterval(player.gameOver, 200);
                        }
                    }
                
                    player.reload();
                    player.weaponChange();
                
                    if (mouseIsDown)
		            shot();

                    player.move();
                    bulletMove();

                    for (var i = 0; i < enemies.length; i++) {
                        // enemyMove(enemies[i]);
                        enemies[i].move(player.x, player.y);
                    }

                    

                    ctx.fillStyle = 'black';
                    ctx.fillRect(0,0,canvas.width,canvas.height);
                    player.draw();
                    bulletDraw();

                    for (var i = 0; i < enemies.length; i++) {
                        enemies[i].draw();
                    }
                }

            // function Player() {
            //     this.size = 25;
            //     this.x = 50;
            //     this.y = 50;
            //     this.speed = 7;
            //     this.dx = 0; 
            //     this.dy = 0;           
            //     this.acceleration = 0.5; 
            //     this.friction = 0.92;    
            //     this.radian = 0;          
            //     this.eyeSize = this.size / 5;
            //     this.eyeX = 0;           
            //     this.eyeY = 0;
            //     this.weapon = WEAPON.NORMAL;
            //     this.reloadNormal = 0;
            //     this.reloadMachinegun = 0;
            //     this.reloadShotgun = 0;
            // }

            function Bullet(size,x,y,radian,speed,distance) {
                this.size = size;
                this.x = x;
                this.y = y;
                this.radian = radian;
                this.speed = speed;               
                this.limit = Math.round(distance/speed);
            }

           

            
                
        
    
        
                           
                // function draw(){
                    // ctx.clearRect(0,0, canvas.width, canvas.height);
                    // circle.draw();

                    // particles();

                    // // ball.draw();
                    // // hole.draw();
                    // // bow.draw();
                    // // arrow.draw();

                    // for (var i = 0; i < particles.density; i++) {
                    //     particles[i].render();
                    // 

                    // particles.forEach(function (e) {
                        // e.render();
                    // });

                    // for (var i = 0; i < density; i++) {
                    //     particles.push(new particle());
                    // }

                    // if (ball.x == hole.x && ball.y == hole.y)
                    // {
                    //     ball.vx = 0;
                    //     ball.vy = 0;
                    //     ball.color = 'rgb(' + Math.floor(Math.random()*255) + ',' + Math.floor(Math.random()*255) + ',' + Math.floor(Math.random()*255) + ')';
                    // }
                    // else
                    // {
                        // ball.x += ball.vx;
                        // ball.y += ball.vy;

                        // if (ball.y + ball.vy > canvas.height || ball.y + ball.vy < 0)
                        // {
                        //     ball.vy = -ball.vy;
                        // }
                        // if (ball.x + ball.vx > canvas.width || ball.x + ball.vx < 0) 
                        // {
                        //     ball.vx = -ball.vx;
                        // }
                    // }

                
                    // var particles = {},
                    // particleIndex = 0;

                    // particleIndex++;
                    // particles[particleIndex] = this;
                    // this.id = particleIndex;

                    // requestAnimationFrame(draw);
    
                // }

                // canvas.addEventListener('mousemove', function(e) {
                //     ctx.translate(595, 760);
                //     ctx.rotate((Math.PI/180 * 90));
                //     ctx.translate(-595, -760);
                // })
                
            // draw();
            
            </script>
    </body>

</html>